# Production Deployment Guide

Comprehensive guide for deploying and maintaining the Riot API application on the production Raspberry Pi 5 server.

## Table of Contents

1. [Server Details & Access](#server-details--access)
2. [Platform Specifications](#platform-specifications)
3. [Environment Setup & Secrets](#environment-setup--secrets)
4. [Automated Deployment](#automated-deployment)
5. [Manual Deployment](#manual-deployment)
6. [Deployment Types](#deployment-types)
7. [Platform Optimizations (RPi5)](#platform-optimizations-rpi5)
8. [Common Operations](#common-operations)
9. [Troubleshooting](#troubleshooting)
10. [Verification & Monitoring](#verification--monitoring)
11. [Backup & Recovery](#backup--recovery)
12. [Rollback Procedures](#rollback-procedures)
13. [Maintenance](#maintenance)

---

## Server Details & Access

- **Host**: `89.221.212.146`
- **Port**: `2221`
- **User**: `pi`
- **SSH Key**: `~/.ssh/raspberry_pi_key`

### Connect to Server

```bash
ssh -i ~/.ssh/raspberry_pi_key -l pi 89.221.212.146 -p 2221
```

Or add to `~/.ssh/config`:

```
Host riot-prod
    HostName 89.221.212.146
    Port 2221
    User pi
    IdentityFile ~/.ssh/raspberry_pi_key
```

Then connect with: `ssh riot-prod`

### Project Structure

- **Project Directory**: `/home/pi/riot-api`
- **Compose Files**: `compose.yaml` + `compose.prod.yaml`
- **Environment File**: `/home/pi/riot-api/.env` (generated by GitHub Actions)
- **Domain**: `https://leagueanalysis.gg`

### Services

- **Backend API**: `http://localhost:8000` (reverse tunneled to VPS)
- **Frontend**: `http://localhost:3000` (reverse tunneled to VPS)
- **PostgreSQL**: `localhost:5432` (internal only)

---

## Platform Specifications

The production server is a **Raspberry Pi 5** optimized for performance:

- **Device**: Raspberry Pi 5
- **RAM**: 16GB
- **Storage**: 2TB SSD
- **Architecture**: ARM64 (aarch64)
- **CPU**: 4 cores @ 2.4GHz
- **OS**: Raspberry Pi OS (64-bit, Debian-based)

### Expected Performance

**Memory footprint:**

- PostgreSQL: ~500MB-1GB
- Backend (FastAPI): ~200-500MB
- Frontend (Next.js): ~150-300MB
- System + overhead: ~2-4GB
- Available for builds: ~10GB

**Storage usage:**

- Build cache: 50GB allocated
- Docker images: ~2-5GB per deployment
- Database volumes: Grows with data
- Logs: Rotated automatically

---

## Environment Setup & Secrets

### Required Secrets

The application requires the following secrets:

1. **JWT_SECRET_KEY**: JWT token signing secret (32+ characters)
2. **POSTGRES_PASSWORD**: Database password
3. **RIOT_API_KEY**: Riot Games API key (stored in database, set via web UI)

### Generating Secure JWT Secret

The JWT secret must be at least 32 characters (256 bits) to meet RFC 7518 security requirements for HS256 algorithm.

**Generate using Python:**

```bash
python3 -c 'import secrets; print(secrets.token_hex(32))'
```

**Example output**: `a7f8d9e2b4c6f1a3d5e7c9b1f3a5d7e9c2b4f6a8d0e2c4f6a8b0d2e4f6a8b0c2`

**Or using OpenSSL:**

```bash
openssl rand -hex 32
```

### Setting Secrets

**For GitHub Actions Deployment (Primary Method):**

1. Go to repository **Settings** → **Secrets and variables** → **Actions**
2. Add secrets:
   - `JWT_SECRET_KEY`: (generated value from above)
   - `POSTGRES_PASSWORD`: (secure database password)
3. Set Riot API key via web UI at `https://leagueanalysis.gg/settings` after deployment

**For Manual Deployment:**
Create `.env` file in project root on the server:

```bash
# /home/pi/riot-api/.env
JWT_SECRET_KEY=<generated-secret-from-above>
POSTGRES_PASSWORD=<your-secure-password>
ENVIRONMENT=production

# Riot API key is set via web UI at /settings (not in .env)
```

**Security Notes:**

- Never commit `.env` file to git (already in `.gitignore`)
- Never use default values like "dev_secret_key_please_change_in_production"
- The application will **fail to start** in production if an insecure JWT secret is detected
- Rotate secrets every 3-6 months or after security incidents

### Secret Validation

The application validates secrets on startup:

- **Production**: Fails with error if JWT secret is weak or too short
- **Development**: Logs warning but allows startup

Check logs after deployment:

```bash
docker compose -f compose.yaml -f compose.prod.yaml logs backend | grep -i "jwt\|secret\|warning"
```

---

## Automated Deployment

### GitHub Actions Self-Hosted Runner

The server runs a self-hosted GitHub Actions runner that automatically deploys code when pushed to the `main` branch.

**Runner Details:**

- **Name**: `rpi5-16gb-riot-api`
- **Location**: `/home/pi/actions-runner`
- **Process**: Running as systemd user service
- **Status**: Check with `ps aux | grep Runner.Listener`

**Workflow**: `.github/workflows/deploy.yml`

### Deployment Process

When code is pushed to `main`:

1. GitHub Actions workflow triggers
2. Runner checks out code to: `/home/pi/actions-runner/_work/riot-api-project/riot-api-project`
3. Stops existing containers
4. Removes old `/home/pi/riot-api` directory (with sudo for Docker-owned files)
5. Copies fresh code to `/home/pi/riot-api`
6. Generates `.env` file from GitHub Secrets
7. Builds with Docker Bake (parallel backend + frontend builds)
8. Starts services: `docker compose -f compose.yaml -f compose.prod.yaml up -d`
9. Runs health checks (PostgreSQL, Backend API, Frontend)
10. Cleans up unused Docker images

### Triggering Deployment

**Automatic (Recommended):**

```bash
# On local development machine
git add .
git commit -m "Your commit message"
git push origin main

# GitHub Actions handles deployment automatically
```

**Manual Trigger:**

- Go to GitHub Actions tab
- Select "Deploy to Production" workflow
- Click "Run workflow"

### Monitoring Deployment

**Check GitHub Actions:**

- Visit: https://github.com/YourUsername/riot-api-project/actions
- View workflow run logs

**Check on server:**

```bash
ssh riot-prod

# View runner logs
ls -lt ~/actions-runner/_diag/ | head -5
tail -f ~/actions-runner/_diag/Worker_*.log
```

---

## Manual Deployment

For situations where you need to deploy without GitHub Actions:

### Code-Only Deployment

When you only change application code without database schema modifications:

```bash
ssh riot-prod
cd ~/riot-api

# Pull latest code
git pull origin main

# Rebuild and restart
docker compose -f compose.yaml -f compose.prod.yaml up -d --build
```

### Using Build Scripts

```bash
ssh riot-prod
cd ~/riot-api

# Deploy with fresh build
docker compose -f compose.yaml -f compose.prod.yaml down
docker buildx bake -f docker/docker-bake.hcl prod --load --no-cache
docker compose -f compose.yaml -f compose.prod.yaml up -d

# Check status
docker compose -f compose.yaml -f compose.prod.yaml ps
```

---

## Deployment Types

### 1. Code-Only Deployment

When you only change application code without database schema modifications.

**Examples:**

- Bug fixes
- Feature additions that don't change models
- Configuration updates
- UI changes

**Process:**

```bash
git push origin main  # Automatic deployment via GitHub Actions
```

### 2. Schema Deployment

When database schema changes are required.

**Examples:**

- Adding/removing model fields
- Creating new tables
- Modifying relationships
- Changing column types

**Process:**

1. **Deploy Code** (automatic via GitHub Actions):

   ```bash
   git push origin main
   ```

2. **SSH to Production**:

   ```bash
   ssh riot-prod
   cd riot-api
   ```

3. **Run Migrations**:

   ```bash
   # Run Alembic migrations
   docker compose -f compose.yaml -f compose.prod.yaml exec backend uv run alembic upgrade head

   # If migration fails or requires full reset:
   docker compose -f compose.yaml -f compose.prod.yaml exec backend uv run alembic downgrade base
   docker compose -f compose.yaml -f compose.prod.yaml exec backend uv run alembic upgrade head

   # Restart backend to reload configurations
   docker compose -f compose.yaml -f compose.prod.yaml restart backend
   ```

   **Note**: Job configurations are now managed via the web UI at /jobs. Manual seeding scripts have been deprecated.

4. **Verify Deployment** (see [Verification Steps](#verification-steps))

---

## Platform Optimizations (RPi5)

### Docker Configuration

All Docker builds and configurations are optimized for ARM64 architecture:

- **Parallel Builds**: 2 concurrent builds (tuned for 4-core CPU)
- **Memory Allocation**: 3GB per Node.js build (conservative for 16GB RAM)
- **Build Cache**: 50GB cache on SSD for fast rebuilds
- **No Resource Limits**: cgroup resource limits removed (optional kernel config)

### Build Performance

Expected build times on RPi5:

- **Full production build** (backend + frontend): 5-10 minutes
- **Backend only**: 2-4 minutes
- **Frontend only**: 3-6 minutes
- **Rebuild with cache**: 1-3 minutes

**Notes:**

- First build may take longer due to dependency downloads
- SSD storage provides optimal I/O
- Builds use Docker Bake for parallel compilation

### Using Docker Bake

All builds use Docker Bake for efficient parallel compilation:

```bash
# Build production images (automatic in deployment)
docker buildx bake -f docker/docker-bake.hcl prod --load

# Build development images (for testing)
docker buildx bake -f docker/docker-bake.hcl dev --load

# Build specific service
docker buildx bake -f docker/docker-bake.hcl backend-prod --load
```

---

## Common Operations

### Check Service Status

```bash
ssh riot-prod
cd ~/riot-api

# Check all containers
docker compose -f compose.yaml -f compose.prod.yaml ps

# Check health endpoints
curl http://localhost:8000/health
curl http://localhost:3000

# View logs (all services)
docker compose -f compose.yaml -f compose.prod.yaml logs -f

# View logs (specific service)
docker compose -f compose.yaml -f compose.prod.yaml logs -f backend
docker compose -f compose.yaml -f compose.prod.yaml logs -f frontend
docker compose -f compose.yaml -f compose.prod.yaml logs -f postgres
```

### Restart Services

```bash
ssh riot-prod
cd ~/riot-api

# Restart all services
docker compose -f compose.yaml -f compose.prod.yaml restart

# Restart specific service
docker compose -f compose.yaml -f compose.prod.yaml restart backend
docker compose -f compose.yaml -f compose.prod.yaml restart frontend
```

### Database Operations

```bash
ssh riot-prod
cd ~/riot-api

# Run migrations
docker compose -f compose.yaml -f compose.prod.yaml exec backend uv run alembic upgrade head

# Check migration status
docker compose -f compose.yaml -f compose.prod.yaml exec backend uv run alembic current

# View migration history
docker compose -f compose.yaml -f compose.prod.yaml exec backend uv run alembic history

# Connect to database
docker compose -f compose.yaml -f compose.prod.yaml exec postgres psql -U riot_api_user -d riot_api_db

# Backup database
docker compose -f compose.yaml -f compose.prod.yaml exec postgres pg_dump -U riot_api_user riot_api_db > backup_$(date +%Y%m%d_%H%M%S).sql

# Check database statistics
docker compose -f compose.yaml -f compose.prod.yaml exec postgres psql -U riot_api_user -d riot_api_db -c "
SELECT
    (SELECT COUNT(*) FROM matches) as match_count,
    (SELECT COUNT(*) FROM players) as player_count,
    (SELECT COUNT(*) FROM job_configurations) as job_count;
"
```

### Monitor Resources

```bash
ssh riot-prod

# Memory usage
free -h

# Disk usage
df -h

# CPU and uptime
uptime

# Docker resource usage (real-time)
docker stats

# Docker disk usage
docker system df
```

### Reverse Tunnel (autossh)

The server uses autossh to create a reverse SSH tunnel to a VPS for public access via `https://leagueanalysis.gg`.

**Check tunnel status:**

```bash
ssh riot-prod

# Check if autossh is running
ps aux | grep autossh

# Check tunnel ports
ss -tlnp | grep -E ':8000|:3000'
```

**Restart tunnel (if needed):**

```bash
# If configured as systemd service
sudo systemctl restart autossh-tunnel.service
# OR
systemctl --user restart autossh-tunnel.service
```

---

## Troubleshooting

### Deployment Failed in GitHub Actions

**Steps:**

1. Check the Actions tab: https://github.com/YourUsername/riot-api-project/actions
2. SSH to server and check runner logs:
   ```bash
   ssh riot-prod
   tail -100 ~/actions-runner/_diag/Worker_*.log
   ```
3. Check disk space:
   ```bash
   df -h
   docker system df
   ```
4. Check Docker status:
   ```bash
   docker ps -a
   docker compose -f compose.yaml -f compose.prod.yaml ps
   ```

### GitHub Actions Runner Not Responding

```bash
ssh riot-prod

# Check if runner is running
ps aux | grep Runner.Listener

# Check runner service status (if configured as systemd service)
systemctl --user status actions.runner.*.service

# Restart runner service
systemctl --user restart actions.runner.*.service

# Or manually start runner
cd ~/actions-runner
./run.sh
```

### Service Won't Start

```bash
# Check container logs
docker compose -f compose.yaml -f compose.prod.yaml logs backend --tail=100

# Check if ports are in use
sudo netstat -tulpn | grep -E '8000|3000|5432'

# Restart with fresh containers
docker compose -f compose.yaml -f compose.prod.yaml down
docker compose -f compose.yaml -f compose.prod.yaml up -d
```

### Database Connection Errors

```bash
# Check PostgreSQL is running
docker compose -f compose.yaml -f compose.prod.yaml exec postgres pg_isready -U riot_api_user -d riot_api_db

# Check database size
docker compose -f compose.yaml -f compose.prod.yaml exec postgres psql -U riot_api_user -d riot_api_db -c "\l+"

# Check tables exist
docker compose -f compose.yaml -f compose.prod.yaml exec postgres psql -U riot_api_user -d riot_api_db -c "\dt"

# Restart PostgreSQL
docker compose -f compose.yaml -f compose.prod.yaml restart postgres
```

### Missing Database Column Error

**Symptoms:**

```
sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError
<class 'asyncpg.exceptions.UndefinedColumnError'>: column job_executions.detailed_logs does not exist
```

**Cause:** Production database schema is outdated after code deployment.

**Solution:**

```bash
ssh riot-prod
cd ~/riot-api

# Run migrations
docker compose -f compose.yaml -f compose.prod.yaml exec backend uv run alembic upgrade head

# If that fails, reset schema:
docker compose -f compose.yaml -f compose.prod.yaml exec backend uv run alembic downgrade base
docker compose -f compose.yaml -f compose.prod.yaml exec backend uv run alembic upgrade head
docker compose -f compose.yaml -f compose.prod.yaml restart backend
```

### Foreign Key Violations After Schema Reset

**Symptoms:**

```
ForeignKeyViolationError: insert or update on table "job_executions"
violates foreign key constraint
```

**Cause:** Job scheduler started before job configurations were seeded.

**Solution:**

```bash
# Job configurations are now managed via web UI at /jobs
# Ensure job configurations exist in database, or configure via UI

# Restart backend
docker compose -f compose.yaml -f compose.prod.yaml restart backend
```

### Jobs Not Running

**Symptoms:**

- No job executions in logs
- Job status shows 0 active jobs

**Debugging:**

```bash
# Check job configurations in database
docker compose -f compose.yaml -f compose.prod.yaml exec postgres psql -U riot_api_user -d riot_api_db -c "SELECT * FROM job_configurations;"

# Check backend logs for scheduler messages
docker compose -f compose.yaml -f compose.prod.yaml logs backend | grep -i scheduler

# Verify job status via API
curl http://localhost:8000/api/v1/jobs/status/overview
```

**Solution:**

1. Check job configurations exist via web UI at /jobs or query database
2. Restart backend: `docker compose -f compose.yaml -f compose.prod.yaml restart backend`
3. Check Riot API key is valid (dev keys expire every 24h)

### Build Failures

**Issue: Out of memory during build**

```bash
# Check available memory
free -h

# Stop unnecessary services
docker compose -f compose.yaml -f compose.prod.yaml down

# Build services individually
docker buildx bake -f docker/docker-bake.hcl backend-prod --load
docker buildx bake -f docker/docker-bake.hcl frontend-prod --load
```

**Issue: Build cache problems**

```bash
# Clear build cache
docker buildx prune -a

# Rebuild without cache
docker compose -f compose.yaml -f compose.prod.yaml build --no-cache
```

### Performance Issues

**Issue: Slow build times**

```bash
# Check SSD health
sudo smartctl -a /dev/sda  # Adjust device path

# Check I/O wait
iostat -x 1

# Check for thermal throttling
vcgencmd measure_temp
vcgencmd get_throttled
```

**Issue: Memory pressure**

```bash
# Check memory usage
free -h
docker stats --no-stream

# Stop and restart services
docker compose -f compose.yaml -f compose.prod.yaml restart
```

### Stale Docker Images

**Symptoms:**

- Code changes not appearing
- Old behavior persists after deployment

**Solution:**

```bash
# Rebuild images without cache
docker compose -f compose.yaml -f compose.prod.yaml build --no-cache

# Restart services
docker compose -f compose.yaml -f compose.prod.yaml up -d
```

---

## Verification & Monitoring

### Post-Deployment Checklist

After deployment, verify all systems are operational:

- [ ] **Health Check Passes**

  ```bash
  curl http://localhost:8000/health
  # Expected: {"status":"healthy","message":"Application is running"...}
  ```

- [ ] **All Services Running**

  ```bash
  docker compose -f compose.yaml -f compose.prod.yaml ps
  # Expected: All services showing "Up" and "healthy"
  ```

- [ ] **Job Scheduler Active**

  ```bash
  curl http://localhost:8000/api/v1/jobs/status/overview | python3 -m json.tool
  # Expected: "scheduler_running": true, "active_jobs": 2
  ```

- [ ] **Database Contains Data**

  ```bash
  docker compose -f compose.yaml -f compose.prod.yaml exec postgres psql -U riot_api_user -d riot_api_db -c "
  SELECT COUNT(*) FROM job_configurations;
  SELECT COUNT(*) FROM players WHERE is_tracked = true;
  "
  # Expected: 2 job configs, at least 1 tracked player
  ```

- [ ] **No Critical Errors in Logs**

  ```bash
  docker compose -f compose.yaml -f compose.prod.yaml logs backend --tail=100 | grep -i error
  # Expected: No critical errors (some warnings OK)
  ```

- [ ] **Frontend Accessible**

  ```bash
  curl -I http://localhost:3000
  # Expected: HTTP/1.1 200 OK
  ```

- [ ] **Public Domain Works**
  ```bash
  curl -I https://leagueanalysis.gg
  # Expected: HTTP/2 200
  ```

### Continuous Monitoring

**Service health:**

```bash
# Set up a cron job to check health every 5 minutes
*/5 * * * * curl -f http://localhost:8000/health || echo "Backend health check failed" | mail -s "Alert: Backend Down" admin@example.com
```

**Resource usage:**

```bash
# Check resources weekly
docker stats --no-stream
free -h
df -h
```

**Job execution:**

```bash
# Check job status daily
curl http://localhost:8000/api/v1/jobs/status/overview
```

---

## Backup & Recovery

### Database Backup

**Create backup:**

```bash
ssh riot-prod
cd ~/riot-api

# Full database backup
docker compose -f compose.yaml -f compose.prod.yaml exec postgres pg_dump -U riot_api_user riot_api_db > backup_$(date +%Y%m%d_%H%M%S).sql

# Compressed backup
docker compose -f compose.yaml -f compose.prod.yaml exec postgres pg_dump -U riot_api_user riot_api_db | gzip > backup_$(date +%Y%m%d_%H%M%S).sql.gz
```

**Restore from backup:**

```bash
# From SQL file
cat backup.sql | docker compose -f compose.yaml -f compose.prod.yaml exec -T postgres psql -U riot_api_user -d riot_api_db

# From compressed backup
gunzip -c backup.sql.gz | docker compose -f compose.yaml -f compose.prod.yaml exec -T postgres psql -U riot_api_user -d riot_api_db
```

### Full System Backup

The 2TB SSD should include regular backups:

- **Database volumes**: `/var/lib/docker/volumes/`
- **Configuration**: `/home/pi/riot-api/.env`
- **Code**: Version controlled via Git
- **Runner config**: `/home/pi/actions-runner/.credentials`

**Automated backup script** (recommended):

```bash
#!/bin/bash
# /home/pi/backup.sh

DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/mnt/external-backup"

# Backup database
cd /home/pi/riot-api
docker compose -f compose.yaml -f compose.prod.yaml exec postgres pg_dump -U riot_api_user riot_api_db | gzip > "$BACKUP_DIR/db_$DATE.sql.gz"

# Backup .env (contains secrets)
cp /home/pi/riot-api/.env "$BACKUP_DIR/env_$DATE"

# Keep only last 30 days of backups
find "$BACKUP_DIR" -name "db_*.sql.gz" -mtime +30 -delete
find "$BACKUP_DIR" -name "env_*" -mtime +30 -delete
```

---

## Rollback Procedures

If deployment fails or introduces critical bugs:

### 1. Identify Last Working Commit

```bash
ssh riot-prod
cd ~/riot-api

git log --oneline -10
```

### 2. Revert to Previous Version

```bash
# Checkout previous commit
git checkout <previous-commit-hash>

# Rebuild and restart
docker compose -f compose.yaml -f compose.prod.yaml up -d --build
```

### 3. Restore Database (if needed)

**If database backup exists:**

```bash
# Restore from backup
cat backup.sql | docker compose -f compose.yaml -f compose.prod.yaml exec -T postgres psql -U riot_api_user -d riot_api_db
```

**If no backup, reset using Alembic:**

```bash
# Reset schema using migrations
docker compose -f compose.yaml -f compose.prod.yaml exec backend uv run alembic downgrade base
docker compose -f compose.yaml -f compose.prod.yaml exec backend uv run alembic upgrade head

# Restart backend
docker compose -f compose.yaml -f compose.prod.yaml restart backend

# Note: Job configurations and tracked players now managed via web UI
```

### 4. Verify Rollback

Run through [Post-Deployment Checklist](#post-deployment-checklist) to ensure system is stable.

---

## Maintenance

### Regular Tasks

**Weekly:**

- Check disk usage: `df -h`
- Review logs for errors: `docker compose logs backend --tail=500 | grep -i error`
- Verify backups completed successfully
- Check resource usage: `docker stats --no-stream`

**Monthly:**

- Update system packages: `sudo apt update && sudo apt upgrade`
- Clean up old images: `docker image prune -a`
- Review Docker disk usage: `docker system df`
- Test backup restoration (on dev environment)
- Review and optimize database queries if performance degrades

**Quarterly:**

- Rotate JWT secret (update GitHub Secret and redeploy)
- Review database size and consider archiving old data
- Update dependencies in `backend/pyproject.toml` and `frontend/package.json`
- Performance audit and optimization

**As Needed:**

- Update Riot API key (dev keys expire every 24h, production keys are long-lived)
- Apply security patches
- Migrate to new server/platform if needed

### Known Warnings (Harmless)

**npm Deprecation Warnings:**

```
npm warn deprecated @babel/plugin-proposal-private-methods@7.18.6
```

**Status**: Harmless - transitive dependencies from Next.js, will be updated in future releases.

**cgroup Memory Warnings:**

```
Your kernel does not support memory limit capabilities or the cgroup is not mounted.
```

**Status**: Expected - resource limits removed from compose files. Optional to enable via `/boot/firmware/cmdline.txt`.

---

## Security Notes

- **SSH**: Key-based authentication (password auth disabled)
- **Firewall**: Configured for ports 2221 (SSH), 8000 (backend), 3000 (frontend)
- **Secrets**: Managed via GitHub Secrets (never committed to repo)
- **Reverse Tunnel**: autossh provides external HTTPS access via VPS
- **Database**: Not exposed externally, internal Docker network only
- **Riot API Key**: Stored in database only, rotated as needed

---

## Quick Reference

```bash
# === Deployment ===
# Automatic deployment
git push origin main

# Manual deployment
ssh riot-prod
cd ~/riot-api
git pull origin main
docker compose -f compose.yaml -f compose.prod.yaml up -d --build

# === Status Checks ===
# Health check
curl http://localhost:8000/health

# Service status
docker compose -f compose.yaml -f compose.prod.yaml ps

# Job status
curl http://localhost:8000/api/v1/jobs/status/overview

# View logs
docker compose -f compose.yaml -f compose.prod.yaml logs -f backend

# === Operations ===
# Restart services
docker compose -f compose.yaml -f compose.prod.yaml restart

# Run migrations
docker compose -f compose.yaml -f compose.prod.yaml exec backend uv run alembic upgrade head

# Backup database
docker compose -f compose.yaml -f compose.prod.yaml exec postgres pg_dump -U riot_api_user riot_api_db > backup.sql

# === Troubleshooting ===
# Emergency restart
docker compose -f compose.yaml -f compose.prod.yaml down
docker compose -f compose.yaml -f compose.prod.yaml up -d

# Clear cache and rebuild
docker buildx prune -a
docker compose -f compose.yaml -f compose.prod.yaml build --no-cache
docker compose -f compose.yaml -f compose.prod.yaml up -d
```

---

## Related Documentation

- [Backend Documentation](../backend/AGENTS.md) - Backend API details
- [Frontend Documentation](../frontend/AGENTS.md) - Frontend application details
- [Docker Documentation](../docker/AGENTS.md) - Docker Compose and build configuration
- [Alembic Migrations](../backend/alembic/AGENTS.md) - Database migration guide
- [Database Schema](./architecture/database.md) - Database entity relationships
- [Background Jobs](./architecture/jobs.md) - Background job system documentation
- [Project README](../README.md) - Project overview and quick start

---

## Support & Contact

For deployment issues:

1. Check logs: `docker compose -f compose.yaml -f compose.prod.yaml logs`
2. Review GitHub Actions workflow runs
3. Check system resources: `free -h`, `df -h`, `docker stats`
4. Verify network connectivity and DNS resolution
5. Consult troubleshooting section above

---

**Last Updated**: 2025-10-29 (consolidated from multiple deployment guides)
